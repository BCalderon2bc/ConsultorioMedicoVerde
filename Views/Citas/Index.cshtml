@model IEnumerable<ConsultorioVerde.Web.Models.CitaViewModel>

<div class="d-flex justify-content-between align-items-center mb-4">
    <h2 class="text-verde fw-bold"><i class="bi bi-calendar-event me-2"></i>Agenda de Citas Médicas</h2>
    <a asp-action="Programar" class="btn btn-verde shadow-sm">
        <i class="bi bi-plus-lg"></i> Agendar Nueva Cita
    </a>
</div>

<div class="card shadow-sm border-0">
    <div class="table-responsive">
        <table class="table table-hover align-middle mb-0">
            <thead class="table-light">
                <tr>
                    <th>ID</th>
                    <th>Fecha y Hora</th>
                    <th>Paciente</th>
                    <th>Médico</th>
                    <th>Motivo</th>
                    <th class="text-center">Estado</th>
                    <th class="text-center">Acciones</th>
                </tr>
            </thead>
            <tbody>
                @foreach (var item in Model)
                {
                    <tr>
                        <td class="text-muted">#@item.IdCita</td>
                        <td class="fw-bold">@item.FechaCita.ToString("dd/MM/yyyy hh:mm tt")</td>
                        <td><i class="bi bi-person me-1"></i> @item.NombrePaciente</td>
                        <td><i class="bi bi-person-badge me-1"></i> @item.NombreMedico</td>
                        <td class="small text-truncate" style="max-width: 200px;">@item.Motivo</td>
                        <td class="text-center">
                            @switch (item.Estado?.ToLower())
                            {
                                case "pendiente":
                                    <span class="badge bg-warning text-dark">Pendiente</span>
                                    break;
                                case "programada":
                                    <span class="badge bg-primary">Programada</span>
                                    break;
                                case "completada":
                                    <span class="badge bg-info">Completada</span>
                                    break;
                                case "cancelada":
                                    <span class="badge bg-danger">Cancelada</span>
                                    break;
                                default:
                                    <span class="badge bg-secondary">@item.Estado</span>
                                    break;
                            }
                        </td>
                        <td class="text-center">
                            <div class="btn-group shadow-sm">
                                @* Botón Editar Cita (Reasigna fecha/médico) *@
                                <a asp-action="Programar" asp-route-id="@item.IdCita" class="btn btn-sm btn-outline-primary" title="Editar Cita">
                                    <i class="bi bi-pencil"></i>
                                </a>

                                @* Botón Eliminar/Cancelar *@
                                <button class="btn btn-sm btn-outline-danger" title="Cancelar Cita">
                                    <i class="bi bi-trash"></i>
                                </button>

                                @* Botón Atender Paciente (Solo para Médicos o Admin) *@
                                @if (User.IsInRole("Medico") || User.IsInRole("Admin"))
                                {
                                    <a asp-action="Atender" asp-route-id="@item.IdCita" class="btn btn-sm btn-success text-white" title="Atender Paciente">
                                        <i class="bi bi-stethoscope me-1"></i> Atender
                                    </a>
                                }
                            </div>
                        </td>
                    </tr>
                }
            </tbody>
        </table>
    </div>
</div>